[ { "title": "Create a Ubuntu Cloud Proxmox template via Script", "url": "/posts/proxmox-template/", "categories": "documentation, software, proxmox", "tags": "proxmox, template, script", "date": "2022-06-28 00:11:00 +0200", "snippet": "Creating the scriptCreate an executable script to create a proxmox image. The filename for this script is: proxmox-create-ubuntu20.04-cloud-template.sh#!/bin/bash# Must run on Proxmox VE 7 server# Not sure how to handle a cluster - either run on each node or copy template after creating on one?# e.g. $ ssh root@proxmox.server &lt; proxmox-create-cloud-template.shSRC_IMG=\"https://cloud-images.ubuntu.com/focal/current/focal-server-cloudimg-amd64-disk-kvm.img\"IMG_NAME=\"focal-server-cloudimg-amd64-disk-kvm.qcow2\"TEMPL_NAME=\"ubuntu2004-cloud-base\"VMID=\"9001\"MEM=\"512\"DISK_SIZE=\"8G\"DISK_STOR=\"local-lvm\"NET_BRIDGE=\"vmbr0\"# Below step should be ecexuted only once# To install MacOS use brew install libguestfs-tools# to check if installed run libguestfs-test-tool --v# Install libguesetfs-tools to modify cloud image# apt update# apt install -y libguestfs-tools# Download kvm image and rename# Ubuntu img is actually qcow2 format and Proxmox doesn't like wrong extensionswget -O $IMG_NAME $SRC_IMG# Ubuntu cloud img doesn't include qemu-guest-agent required for packer to get IP details from proxmox# Add any additional packages you want installed in the templatevirt-customize --install qemu-guest-agent -a $IMG_NAME# Create cloud-init enabled Proxmox VM with DHCP addressingqm create $VMID --name $TEMPL_NAME --memory $MEM --net0 virtio,bridge=$NET_BRIDGEqm importdisk $VMID $IMG_NAME $DISK_STORqm set $VMID --scsihw virtio-scsi-pci --scsi0 $DISK_STOR:vm-$VMID-disk-0qm set $VMID --ide2 $DISK_STOR:cloudinitqm set $VMID --boot c --bootdisk scsi0qm set $VMID --serial0 socket --vga serial0qm set $VMID --ipconfig0 ip=dhcpqm resize $VMID scsi0 $DISK_SIZE# enable qume-guest-agent hostqm set $VMID --agent 1# Convert to templateqm template $VMID# Remove downloaded imagerm $IMG_NAME# Next, use packer to clone this template and customize it!# References# https://gist.github.com/chriswayg/43fbea910e024cbe608d7dcb12cb8466# https://whattheserver.com/proxmox-cloud-init-os-template-creation/# https://norocketscience.at/deploy-proxmox-virtual-machines-using-cloud-init/# https://pve.proxmox.com/wiki/Cloud-Init_Support# https://blog.dustinrue.com/2020/05/going-deeper-with-proxmox-cloud-init/Make the file executableRun this command to make the file executable: chmod u+x proxmox-create-ubuntu20.04-cloud-template.shExecute the scriptTo execute the script run: ./proxmox-create-ubuntu20.04-cloud-template.sh# Execute the script via sshRun the below command ssh user@remotehost 'bash -s' &lt; script.shThe bash -s command means “execute the following commands in a new bash session.” The -s flag makes it read from standard input, and the &lt; script.sh bit will read a local script file into standard input.The file is read entirely locally, and all gets sent to the remote server without uploading anything. This does require you to put all the commands into a separate script file." }, { "title": "Creating markdown files", "url": "/posts/jekyll/", "categories": "documentation, software, markup", "tags": "markup, cheatsheet", "date": "2022-06-21 00:11:00 +0200", "snippet": "Heading 1A heading level 1 is created with a single pound “#”.Heading 2A heading level 2 is created with a double pound “##”.Unorderd listTo create an unordered list, add dashes (-), asterisks (*), or plus signs (+) in front of line items: list item 1 list item 2Orderd listTo create an ordered list, add line items with numbers followed by periods: first item second itemIf you need to start an unordered list item with a number followed by a period, you can use a backslash () to escape the period: 1986. A great year!Check lists Tasklist item one Tasklist item two Tasklist item threeBlockquotes To create a blockquote use start with the “&gt;”.Bold textTo bold text, add two asterisks or underscores before and after a word or phrase.Line Breaks A line break is created with the html tag &lt;br&gt;StrikethroughTo strike thrrough start and end with double “~~”.Code block JavaScriptconsole.log('hello world');Code block YamlapiVersion: apps/v1kind: Deploymentmetadata: name: nginx-deployment labels: app: nginxspec: replicas: 3 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.14.2 ports: - containerPort: 80Code block bashJEKYLL_ENV=production bundle exec jekyll bBuilding with DockerCreate a Dockerfile with the followingFROM nginx:stable-alpineCOPY _site /usr/share/nginx/html Jekyll can delay posts which have the date/time set for a point in the future determined by the “front matter” section at the top of your post file. Check the date &amp; time as well as time zone if you don’t see a post appear shortly after re-build.ImagesEither point to a file:My AvatarLink to documentationSee more post formatting rules on the Jekyll site" } ]
